{% extends "base.html" %}

{% block page_title %}Owners registrados{% endblock %}

{% block page_actions %}
  <a class="button button-ghost" href="{{ url_for('main.super_admin_dashboard') }}">Panel global</a>
{% endblock %}

{% block content %}
<section class="panel">
  <div class="panel-header">
    <div>
      <h2>Owners registrados</h2>
      <p class="muted">Usuarios owner en todos los talleres</p>
    </div>
  </div>
  {% if owners %}
    <div class="table-scroll">
      <table class="table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Talleres</th>
            <th>Estado</th>
            <th>Confirmacion</th>
            <th>Creado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for owner in owners %}
            <tr>
              <td>{{ owner.full_name }}</td>
              <td>{{ owner.email }}</td>
              <td>
                {% if owner.workshops %}
                  {{ owner.workshops | map(attribute='name') | join(', ') }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                <span class="status {{ 'success' if owner.is_active else 'muted' }}">
                  {{ 'Activo' if owner.is_active else 'Inactivo' }}
                </span>
              </td>
              <td>
                <span class="status {{ 'success' if owner.email_confirmed else 'in_progress' }}">
                  {{ 'Confirmado' if owner.email_confirmed else 'Pendiente' }}
                </span>
              </td>
              <td>{{ owner.created_at.strftime('%Y-%m-%d') if owner.created_at else '-' }}</td>
              <td>
                <div class="table-actions">
                  <form method="post" class="inline-form js-confirm" action="{{ url_for('main.super_admin_owner_toggle', user_id=owner.id) }}" data-confirm-title="Cambiar estado" data-confirm-message="Cambiar el estado de este owner?" data-confirm-final="Confirmar cambio de estado" data-confirm-final-accept="Confirmar">
                    {{ form.hidden_tag() }}
                    <button class="button button-ghost" type="submit">
                      {{ 'Desactivar' if owner.is_active else 'Activar' }}
                    </button>
                  </form>
                  <form method="post" class="inline-form js-confirm" action="{{ url_for('main.super_admin_owner_reset_password', user_id=owner.id) }}" data-confirm-title="Reset de contrasena" data-confirm-message="Generar una nueva contrasena temporal?" data-confirm-final="Confirmar reset" data-confirm-final-accept="Generar">
                    {{ form.hidden_tag() }}
                    <button class="button button-ghost" type="submit">Resetear password</button>
                  </form>
                  <form method="post" class="inline-form js-confirm" action="{{ url_for('main.super_admin_owner_force_confirmation', user_id=owner.id) }}" data-confirm-title="Revalidar email" data-confirm-message="Forzar revalidacion de email?" data-confirm-final="Confirmar revalidacion" data-confirm-final-accept="Enviar">
                    {{ form.hidden_tag() }}
                    <button class="button button-ghost" type="submit">Forzar email</button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">No hay owners registrados.</p>
  {% endif %}
</section>
{% endblock %}
