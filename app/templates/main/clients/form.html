{% extends "base.html" %}

{% block page_title %}{{ title }}{% endblock %}

{% block page_actions %}
  <a class="button button-ghost" href="{{ url_for('main.clients') }}">Volver</a>
{% endblock %}

{% block content %}
  <section class="panel panel-scroll">
    <div class="panel-header">
      <h2>{{ title }}</h2>
      <span class="pill">Clientes</span>
    </div>
    <div class="panel-body">
      <form method="post" class="form-stack" id="clientForm">
        {{ form.hidden_tag() }}
        <div class="form-grid">
          <label>
            Nombre completo
            {{ form.full_name(class_="input", required=True, autocomplete="name") }}
            {% if form.full_name.errors %}
              <span class="field-error">{{ form.full_name.errors[0] }}</span>
            {% endif %}
          </label>
          <label>
            Email
            {{ form.email(class_="input", required=True, type="email", autocomplete="email", inputmode="email", autocapitalize="off", spellcheck="false") }}
            {% if form.email.errors %}
              <span class="field-error">{{ form.email.errors[0] }}</span>
            {% endif %}
          </label>
          <label>
            Telefono
            {{ form.phone(class_="input", required=True, type="tel", autocomplete="tel", inputmode="tel") }}
            {% if form.phone.errors %}
              <span class="field-error">{{ form.phone.errors[0] }}</span>
            {% endif %}
          </label>
        </div>
        <div class="form-actions">
          <button class="button" type="submit">{{ submit_label }}</button>
          <a class="button button-ghost" href="{{ url_for('main.clients') }}">Cancelar</a>
        </div>
      </form>
    </div>
  </section>
  <script>
    const clientForm = document.querySelector("#clientForm");
    if (clientForm) {
      const submitButton = clientForm.querySelector("button[type=\"submit\"]");
      const requiredFields = [
        clientForm.querySelector("input[name=\"full_name\"]"),
        clientForm.querySelector("input[name=\"email\"]"),
        clientForm.querySelector("input[name=\"phone\"]"),
      ].filter(Boolean);

      const updateState = () => {
        const allFilled = requiredFields.every((field) => field.value.trim().length > 0);
        if (submitButton) {
          submitButton.disabled = !allFilled;
        }
      };

      requiredFields.forEach((field) => {
        field.addEventListener("input", updateState);
      });
      updateState();
    }
  </script>
{% endblock %}
